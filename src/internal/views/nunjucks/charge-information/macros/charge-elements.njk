{% macro chargeElementsForm(chargeElements, isEditable) %}
  <form method="post"  action="{{action}}" novalidate="novalidate">
    <input type="hidden" name="csrf_token" value="{{ csrfToken }}"/>

    {% for chargeElement in chargeElements %}

      <section class="govuk-!-margin-bottom-7">
        <h2 class="govuk-heading-m govuk-!-margin-bottom-1">Element
          {{loop.index}}</h2>
        {% for validationWarning in chargeElement.validationWarnings %}
          {{
          govukWarningText({
            text: validationWarning,
            iconFallbackText: "Warning",
            classes: "govuk-!-margin-bottom-1"
          })
        }}
        {% endfor %}
        <dl class="govuk-summary-list">
          {{ summaryListRow('Purpose', chargeElement.purposeUse.name, changeLink('/purpose', chargeElement.id)) }}
          {{ summaryListRow('Description', chargeElement.description, changeLink('/description', chargeElement.id)) }}
          {{ summaryListRow('Abstraction period', chargeElement.abstractionPeriod | abstractionPeriod, changeLink('/abstraction', chargeElement.id)) }}

          {# Quantities have been combined to a single list row to avoid adjacent identical Change links going to the same page #}
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Annual quantities</dt>
            <dd class="govuk-summary-list__value">
              <ul class="govuk-list">
                <li>
                  {{ chargeElement.authorisedAnnualQuantity | number + 'ML authorised' }}
                </li>
                <li>
                  {{chargeElement.billableAnnualQuantity | number + 'ML billable' if chargeElement.billableAnnualQuantity else 'Billable not set' }}
                </li>
              </ul>
            </dd>
            {% if isEditable %}
              <dd class="govuk-summary-list__actions">
                <a href="{{ changeLink('/quantities', chargeElement.id) }}">Change</a>
              </dd>
            {% endif %}
          </div>


          {% set timeLimited = 'No' %}
          {% if chargeElement.timeLimitedPeriod %}
            {% set timeLimited %}
            {{ timeLimitedPeriod(chargeElement.timeLimitedPeriod) }}
            {% endset %}
          {% endif %}
          {{ summaryListRow('Time limit', timeLimited, changeLink('/time', chargeElement.id)) }}
          {{ summaryListRow('Source', chargeElement.source | title, changeLink('/source', chargeElement.id)) }}
          {{ summaryListRow('Season', chargeElement.season | title, changeLink('/season', chargeElement.id)) }}
          {{ summaryListRow('Loss', chargeElement.loss | title, changeLink('/loss', chargeElement.id)) }}
          {{ summaryListRow('Environmental Improvement Unit Charge', chargeElement.eiucSource | title) }}

          {% if chargeElement.purposeUse.isTwoPartTariff %}
            {{ summaryListRow(
              'Agreements apply',
              agreementsApplyText(chargeElement.isSection127AgreementEnabled),
              changeLink('/agreements', chargeElement.id)
            )}}
          {% endif %}
        </dl>
        {% if isEditable %}
          <div class="govuk-grid-row">
            <div class="govuk-grid-column-full">

              {% if loop.last %}
                {{ addElementButton() }}
                <hr class="govuk-section-break  govuk-!-margin-bottom-6">
                {{ addChargeReferenceButton() }}
              {% endif %}
              {% if chargeElements.length > 1 %}
                {{ removeElementButton(chargeElement) }}
              {% endif %}

            </div>
          </div>
        {% endif %}
      </section>
    {% endfor %}

    {% if isEditable and chargeElements.length === 0 %}
      {{ addElementButton() }}
      <hr class="govuk-section-break  govuk-!-margin-bottom-6">
      {{ addChargeReferenceButton() }}
    {% endif %}
  </form>
{% endmacro %}